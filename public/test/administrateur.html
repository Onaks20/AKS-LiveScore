<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GSDDM LiveScore | Admin Mots Croisés</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
<style>
:root {
  --primary: #012970;
  --glass: rgba(255,255,255,0.15);
  --border: rgba(255,255,255,0.25);
}
* { box-sizing: border-box; font-family: 'Inter', sans-serif; }

body {
  margin: 0;
  background: linear-gradient(135deg, #012970, #024ea2);
  color: white;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 20px;
}

h1 { text-align: center; font-size: 2rem; margin-bottom: 10px; }
.form-container, .grid-wrapper, .controls { margin-top: 20px; width: 90%; max-width: 1100px; }

input, select, button {
  padding: 8px 12px;
  margin: 4px;
  border-radius: 8px;
  border: none;
  font-size: 1rem;
}

button { cursor: pointer; background: var(--primary); color: white; }

.grid-wrapper {
  display: flex;
  justify-content: center;
  margin-top: 20px;
}

.grid {
  display: grid;
  grid-template-columns: repeat(10, 50px);
  grid-template-rows: repeat(10, 50px);
  gap: 5px;
}

.cell {
  background: rgba(255,255,255,0.18);
  border-radius: 10px;
  border: 1px solid rgba(255,255,255,0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  color: white;
  position: relative;
  font-size: 1rem;
}
.cell span {
  position: absolute;
  top: 2px;
  left: 2px;
  font-size: 0.6rem;
  opacity: 0.7;
}
.controls button { margin-right: 10px; margin-top: 10px; }
</style>
</head>
<body>
<h1>Admin – Mots Croisés</h1>

<div class="form-container">
  <input type="text" id="wordInput" placeholder="Mot">
  <input type="text" id="clueInput" placeholder="Indice">
  <select id="directionInput">
    <option value="h">Horizontal</option>
    <option value="v">Vertical</option>
  </select>
  <button id="addWordBtn">Ajouter Mot</button>
</div>

<div class="controls">
  <button id="revealWordBtn">Révéler Mot Sélectionné</button>
  <button id="revealAllBtn">Révéler Tous les Mots</button>
</div>

<div class="grid-wrapper">
  <div class="grid" id="grid"></div>
</div>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
const socket = io(); // connexion Socket.IO

const GRID_SIZE = 10;
const grid = document.getElementById("grid");
let words = []; // liste des mots ajoutés
let gridCells = Array.from({length: GRID_SIZE}, () =>
  Array.from({length: GRID_SIZE}, () => {
    const cell = document.createElement("div");
    cell.classList.add("cell");
    grid.appendChild(cell);
    return cell;
  })
);

let selectedWordIndex = null;

// Ajouter mot
document.getElementById("addWordBtn").addEventListener("click", () => {
  const word = document.getElementById("wordInput").value.trim().toUpperCase();
  const clue = document.getElementById("clueInput").value.trim();
  const direction = document.getElementById("directionInput").value;

  if(!word || !clue) { alert("Mot et indice requis"); return; }

  // placement simple aléatoire
  let placed = false;
  while(!placed){
    const row = Math.floor(Math.random()*GRID_SIZE);
    const col = Math.floor(Math.random()*GRID_SIZE);
    if(direction === "h" && col + word.length <= GRID_SIZE){
      words.push({word, clue, direction, row, col});
      placed = true;
    } else if(direction === "v" && row + word.length <= GRID_SIZE){
      words.push({word, clue, direction, row, col});
      placed = true;
    }
  }

  renderGrid();
  socket.emit("updateGrid", {words});
  document.getElementById("wordInput").value = "";
  document.getElementById("clueInput").value = "";
});

// Rendre la grille pour l’admin
function renderGrid(){
  // Effacer
  for(let r=0;r<GRID_SIZE;r++){
    for(let c=0;c<GRID_SIZE;c++){
      gridCells[r][c].textContent = "";
      gridCells[r][c].dataset.wordIndex = "";
    }
  }
  // Placer les mots
  words.forEach((w,index)=>{
    for(let i=0;i<w.word.length;i++){
      let r=w.row; let c=w.col;
      if(w.direction==="h") c+=i; else r+=i;
      const cell = gridCells[r][c];
      cell.textContent = w.word[i];
      cell.dataset.wordIndex = index;
    }
  });
}

// Sélection d’un mot au clic
gridCells.flat().forEach(cell=>{
  cell.addEventListener("click", ()=>{
    if(cell.dataset.wordIndex!==""){
      selectedWordIndex = parseInt(cell.dataset.wordIndex);
      alert("Mot sélectionné: " + words[selectedWordIndex].word);
    }
  });
});

// Révéler mot
document.getElementById("revealWordBtn").addEventListener("click", ()=>{
  if(selectedWordIndex!==null){
    socket.emit("revealWord", selectedWordIndex);
  } else {
    alert("Sélectionnez un mot dans la grille pour le révéler");
  }
});

// Révéler tous
document.getElementById("revealAllBtn").addEventListener("click", ()=>{
  socket.emit("revealAll");
});
</script>
</body>
</html>
