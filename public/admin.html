<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin ‚Äî G.E.H</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="/socket.io/socket.io.js"></script>
  <script defer src="./js/admin.js"></script>
  <script src="./js/display.js"></script>
</head>
<style>
  /* ===============================
   ADMIN PANEL - DARK MODE
   =============================== */

  :root {
    --primary: #012970;
    --primary-light: #1b3f8a;
    --accent: #00d4ff;
    --danger: #ff4d4d;
    --success: #27ae60;
    --bg: #0b0f1a;
    --card-bg: #141a2a;
    --border: #1f2a40;
    --text-light: #dbe4ff;
    --text-muted: #8a9bb8;
  }

  /* Body */
  body {
    margin: 0;
    font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
    background: var(--bg);
    color: var(--text-light);
    display: flex;
    flex-direction: column;
    align-items: center;
    min-height: 100vh;
    padding: 20px;
  }

  /* Header */
  .title {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 95%;
    max-width: 1200px;
    margin-bottom: 20px;
  }

  .title img {
    border-radius: 12%;
    width: 70px;
    height: 70px;
  }

  .title h1 {
    text-align: center;
    color: var(--accent);
    margin: 0;
    font-size: 22px;
  }

  .title small {
    font-size: 12px;
    color: var(--text-muted);
  }

  /* Container */
  .admin-container {
    width: 95%;
    max-width: 1200px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5);
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  /* Titres */
  h1,
  h2 {
    color: var(--accent);
    text-align: center;
    margin: 10px 0;
  }

  h3 {
    color: var(--text-muted);
    font-size: 16px;
    margin: 0 0 10px 0;
  }

  /* Sections */
  .buttons,
  .chrono-controls,
  .gestion-match,
  .gestion-info,
  .sect-2 {
    display: flex;
    flex-wrap: wrap;
    gap: 16px;
    justify-content: center;
  }

  .buttons>div,
  .sect-2>div {
    background: #1a2133;
    border: 1px solid var(--border);
    border-radius: 10px;
    padding: 15px;
    min-width: 250px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  /* Boutons */
  button {
    background: var(--primary);
    border: none;
    border-radius: 6px;
    color: #fff;
    font-weight: 600;
    padding: 8px 14px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  button:hover {
    background: var(--primary-light);
  }

  button:active {
    transform: scale(0.96);
  }

  button.danger {
    background: var(--danger);
  }

  button.success {
    background: var(--success);
  }

  /* Selects & Inputs */
  select,
  input[type="text"],
  textarea {
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 8px 10px;
    font-size: 14px;
    outline: none;
    background: #0f1525;
    color: var(--text-light);
    width: 100%;
    max-width: 200px;
  }

  textarea {
    min-height: 100px;
    resize: vertical;
  }

  /* Affichage score */
  .show p {
    font-size: 28px;
    font-weight: bold;
    margin: 0;
    color: var(--accent);
  }

  /* Homme du match */
  .man-of-the-match {
    margin-top: 20px;
    padding: 15px;
    background: rgba(0, 212, 255, 0.1);
    border-left: 5px solid var(--accent);
    border-radius: 8px;
    font-size: 15px;
    font-weight: 500;
    color: var(--accent);
  }

  /* Footer */
  footer {
    text-align: center;
    color: var(--text-muted);
    font-size: 14px;
    margin-top: 20px;
  }

  /* Responsive */
  @media(max-width: 900px) {

    .buttons,
    .sect-2 {
      flex-direction: column;
    }
  }
</style>

<body>
  <!-- blobs d√©coratifs -->
  <div class="liquid-blob blob1" aria-hidden="true"></div>
  <div class="liquid-blob blob2" aria-hidden="true"></div>

  <div class="title">
    <img src="images/Image1.jpg" />
    <div>
      <h1>Groupe Scolaire David Diop Mendes</h1>
      <small>D√©fi du G√©nie en Herbe (11·µâ √âdition)</small>
    </div>
    <img src="images/image2.jpg" />
  </div>

  <div class="admin-container">
    <h1>Panel Admin</h1>

    <div class="buttons">
      <!-- √âquipe A -->
      <div>
        <h3>√âquipe A</h3>
        <select id="selectA">
          <option value="EQUIPE A" selected>EQUIPE A</option>
          <option value="6√®me A">6√®me A</option>
          <option value="6√®me B">6√®me B</option>
          <option value="6√®me C">6√®me C</option>
          <option value="6√®me D">6√®me D</option>
          <option value="6√®me E">6√®me E</option>
          <hr>
          <option value="5√®me A">5√®me A</option>
          <option value="5√®me B">5√®me B</option>
          <option value="5√®me C">5√®me C</option>
          <option value="5√®me D">5√®me D</option>
          <option value="5√®me E">5√®me E</option>
          <hr>
          <option value="4√®me A">4√®me A</option>
          <option value="4√®me B">4√®me B</option>
          <option value="4√®me C">4√®me C</option>
          <option value="4√®me D">4√®me D</option>
          <option value="4√®me E">4√®me E</option>
          <hr>
          <option value="3√®me A">3√®me A</option>
          <option value="3√®me B">3√®me B</option>
          <option value="3√®me C">3√®me C</option>
          <option value="3√®me D">3√®me D</option>
        </select>
        <div>
          <button onclick="updateScore('A',10)">+10</button>
          <button onclick="updateScore('A',20)">+20</button>
          <button onclick="updateScore('A',30)">+30</button>
          <button onclick="updateScore('A',-10)">-10</button>
        </div>
        <div class="show">
          <p id="scoreA">0</p><span>POINTS</span>
        </div>
      </div>

      <!-- √âquipe B -->
      <div>
        <h3>√âquipe B</h3>
        <select id="selectB">
          <option value="EQUIPE B" selected>EQUIPE B</option>
          <option value="6√®me A">6√®me A</option>
          <option value="6√®me B">6√®me B</option>
          <option value="6√®me C">6√®me C</option>
          <option value="6√®me D">6√®me D</option>
          <option value="6√®me E">6√®me E</option>
          <hr>
          <option value="5√®me A">5√®me A</option>
          <option value="5√®me B">5√®me B</option>
          <option value="5√®me C">5√®me C</option>
          <option value="5√®me D">5√®me D</option>
          <option value="5√®me E">5√®me E</option>
          <hr>
          <option value="4√®me A">4√®me A</option>
          <option value="4√®me B">4√®me B</option>
          <option value="4√®me C">4√®me C</option>
          <option value="4√®me D">4√®me D</option>
          <option value="4√®me E">4√®me E</option>
          <hr>
          <option value="3√®me A">3√®me A</option>
          <option value="3√®me B">3√®me B</option>
          <option value="3√®me C">3√®me C</option>
          <option value="3√®me D">3√®me D</option>
        </select>
        <div>
          <button onclick="updateScore('B',10)">+10</button>
          <button onclick="updateScore('B',20)">+20</button>
          <button onclick="updateScore('B',30)">+30</button>
          <button onclick="updateScore('B',-10)">-10</button>
        </div>
        <div class="show">
          <p id="scoreB">0</p><span>POINTS</span>
        </div>
      </div>
    </div>

    <h2>Gestion Match & Infos</h2>
    <div class="gestion-match">
      <button id="save-score" type="button">Enregistrer le score</button>
      <button id="next-match-button">Prochain match</button>
      <button id="shift-result">Afficher la page r√©sultat</button>
      <button id="shift-display">Afficher la page score</button>
      <button id="shift-crossword">Afficher la page Mots Crois√©s</button>
      <button id="shift-stop-image">Afficher la page Arr√™t sur image</button>

      <script src="/socket.io/socket.io.js"></script>
      <script>
        document.getElementById("shift-result").addEventListener("click", () => {
          socket.emit("changePublicPage", "result");
        });

        document.getElementById("shift-display").addEventListener("click", () => {
          socket.emit("changePublicPage", "display");
        });

        document.getElementById("shift-crossword").addEventListener("click", () => {
          socket.emit("changePublicPage", "crossword");
        });

        document.getElementById("shift-stop-image").addEventListener("click", () => {
          socket.emit("changePublicPage", "stop-image");
        });
        // Prochain Match
        document.getElementById("next-match-button")
          .addEventListener("click", () => {
            socket.emit("nextMatch");
          });
      </script>

    </div>

    <div class="gestion-info">
      <textarea id="info" placeholder="Message / informations"></textarea>
      <button type="button" id="info-submit"><i class="fa-solid fa-paper-plane"></i> ENVOYER</button>
    </div>
    <div class="sect-2">
      <!-- Homme du match -->
      <div class="homme-du-match">
        <h2>Homme du Match</h2>
        <input type="text" id="hommeNom" placeholder="Nom du joueur" />
        <select id="hommeEquipe">
          <option value="" selected>CLASSE</option>
          <option value="6√®me A">6√®me A</option>
          <option value="6√®me B">6√®me B</option>
          <option value="6√®me C">6√®me C</option>
          <option value="6√®me D">6√®me D</option>
          <option value="6√®me E">6√®me E</option>
          <hr>
          <option value="5√®me A">5√®me A</option>
          <option value="5√®me B">5√®me B</option>
          <option value="5√®me C">5√®me C</option>
          <option value="5√®me D">5√®me D</option>
          <option value="5√®me E">5√®me E</option>
          <hr>
          <option value="4√®me A">4√®me A</option>
          <option value="4√®me B">4√®me B</option>
          <option value="4√®me C">4√®me C</option>
          <option value="4√®me D">4√®me D</option>
          <option value="4√®me E">4√®me E</option>
          <hr>
          <option value="3√®me A">3√®me A</option>
          <option value="3√®me B">3√®me B</option>
          <option value="3√®me C">3√®me C</option>
          <option value="3√®me D">3√®me D</option>
        </select>
        <button onclick="elireHomme()">√âlire</button>
      </div>

      <!-- Programmer un match -->
      <div class="programmation">
        <h2>Programmer un Match</h2>
        <label>√âquipe A :</label>
        <select id="nextTeamA">
          <option value="" selected>EQUIPE A</option>
          <option value="6√®me A">6√®me A</option>
          <option value="6√®me B">6√®me B</option>
          <option value="6√®me C">6√®me C</option>
          <option value="6√®me D">6√®me D</option>
          <option value="6√®me E">6√®me E</option>
          <hr>
          <option value="5√®me A">5√®me A</option>
          <option value="5√®me B">5√®me B</option>
          <option value="5√®me C">5√®me C</option>
          <option value="5√®me D">5√®me D</option>
          <option value="5√®me E">5√®me E</option>
          <hr>
          <option value="4√®me A">4√®me A</option>
          <option value="4√®me B">4√®me B</option>
          <option value="4√®me C">4√®me C</option>
          <option value="4√®me D">4√®me D</option>
          <option value="4√®me E">4√®me E</option>
          <hr>
          <option value="3√®me A">3√®me A</option>
          <option value="3√®me B">3√®me B</option>
          <option value="3√®me C">3√®me C</option>
          <option value="3√®me D">3√®me D</option>
        </select>
        <label>√âquipe B :</label>
        <select id="nextTeamB">
          <option value="" selected>EQUIPE B</option>
          <option value="6√®me A">6√®me A</option>
          <option value="6√®me B">6√®me B</option>
          <option value="6√®me C">6√®me C</option>
          <option value="6√®me D">6√®me D</option>
          <option value="6√®me E">6√®me E</option>
          <hr>
          <option value="5√®me A">5√®me A</option>
          <option value="5√®me B">5√®me B</option>
          <option value="5√®me C">5√®me C</option>
          <option value="5√®me D">5√®me D</option>
          <option value="5√®me E">5√®me E</option>
          <hr>
          <option value="4√®me A">4√®me A</option>
          <option value="4√®me B">4√®me B</option>
          <option value="4√®me C">4√®me C</option>
          <option value="4√®me D">4√®me D</option>
          <option value="4√®me E">4√®me E</option>
          <hr>
          <option value="3√®me A">3√®me A</option>
          <option value="3√®me B">3√®me B</option>
          <option value="3√®me C">3√®me C</option>
          <option value="3√®me D">3√®me D</option>
        </select>
        <button onclick="programmerMatch()">Programmer</button>
      </div>
    </div>
    <h2>Gestion Arr√™t sur Image & Mots crois√©s</h2>
    <div class="stop-image-admin">
      <input type="file" id="imageInput" accept="image/*" />

      <select id="levelSelector">
        <option value="1">Niveau 1 (40 pts)</option>
        <option value="2">Niveau 2 (30 pts)</option>
        <option value="3">Niveau 3 (20 pts)</option>
        <option value="4">Niveau 4 (10 pts)</option>
      </select>

      <div id="imageWrapper">
        <img id="sourceImage" />
        <div id="gridOverlay"></div>
      </div>
      <script>
        // ===============================
        // CONFIGURATION
        // ===============================
        const GRID_ROWS = 10;
        const GRID_COLS = 10;

        const imageInput = document.getElementById("imageInput");
        const sourceImage = document.getElementById("sourceImage");
        const gridOverlay = document.getElementById("gridOverlay");
        const levelSelector = document.getElementById("levelSelector");

        // Stockage central
        const gameData = {
          image: null,
          tiles: [] // { id, row, col, level }
        };

        // ===============================
        // IMAGE UPLOAD
        // ===============================
        imageInput.addEventListener("change", (e) => {
          const file = e.target.files[0];
          if (!file) return;

          const reader = new FileReader();
          reader.onload = () => {
            sourceImage.src = reader.result;
            gameData.image = reader.result;

            sourceImage.onload = () => {
              createGrid();
            };
          };
          reader.readAsDataURL(file);
        });

        // ===============================
        // CR√âATION DE LA GRILLE
        // ===============================
        function createGrid() {
          gridOverlay.innerHTML = "";
          gameData.tiles = [];

          gridOverlay.style.display = "grid";
          gridOverlay.style.gridTemplateRows = `repeat(${GRID_ROWS}, 1fr)`;
          gridOverlay.style.gridTemplateColumns = `repeat(${GRID_COLS}, 1fr)`;

          let id = 0;

          for (let row = 0; row < GRID_ROWS; row++) {
            for (let col = 0; col < GRID_COLS; col++) {
              const tile = document.createElement("div");
              tile.classList.add("tile");
              tile.dataset.id = id;
              tile.dataset.row = row;
              tile.dataset.col = col;
              tile.dataset.level = "";

              tile.addEventListener("click", () => selectTile(tile));

              gridOverlay.appendChild(tile);

              gameData.tiles.push({
                id,
                row,
                col,
                level: null
              });

              id++;
            }
          }
        }

        // ===============================
        // S√âLECTION D‚ÄôUNE CASE
        // ===============================
        function selectTile(tileElement) {
          const level = parseInt(levelSelector.value);
          const tileId = parseInt(tileElement.dataset.id);

          // Toggle logique
          if (tileElement.dataset.level == level) {
            tileElement.dataset.level = "";
            tileElement.style.backgroundColor = "transparent";
            updateTileData(tileId, null);
            return;
          }

          tileElement.dataset.level = level;
          tileElement.style.backgroundColor = getLevelColor(level);
          updateTileData(tileId, level);
        }

        // ===============================
        // MISE √Ä JOUR DATA
        // ===============================
        function updateTileData(id, level) {
          const tile = gameData.tiles.find(t => t.id === id);
          if (tile) {
            tile.level = level;
          }
        }

        // ===============================
        // COULEURS PAR NIVEAU
        // ===============================
        function getLevelColor(level) {
          switch (level) {
            case 1: return "rgba(255, 0, 0, 0.4)";
            case 2: return "rgba(255, 165, 0, 0.4)";
            case 3: return "rgba(0, 128, 255, 0.4)";
            case 4: return "rgba(0, 200, 0, 0.4)";
            default: return "transparent";
          }
        }

        // ===============================
        // EXPORT (POUR SERVER / PUBLIC)
        // ===============================
        function getAdminGameState() {
          return {
            image: gameData.image,
            grid: {
              rows: GRID_ROWS,
              cols: GRID_COLS
            },
            tiles: gameData.tiles.filter(t => t.level !== null)
          };
        }

      </script>
      <style>
        input[type="file"],
        select {
          background: #020617;
          color: #e5e7eb;
          border: 1px solid #334155;
          padding: 10px 12px;
          border-radius: 6px;
          margin-bottom: 15px;
          cursor: pointer;
        }

        /* ===============================
   WRAPPER IMAGE
================================ */
        #imageWrapper {
          position: relative;
          max-width: 900px;
          margin: auto;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 20px 40px rgba(0, 0, 0, 0.6);
        }

        /* Image responsive */
        #sourceImage {
          width: 100%;
          height: auto;
          display: block;
          user-select: none;
          pointer-events: none;
        }

        /* ===============================
   GRID OVERLAY
================================ */
        #gridOverlay {
          position: absolute;
          inset: 0;
          display: grid;
        }

        /* ===============================
            TILE (CARREAU)
          ================================ */
        .tile {
          border: 1px solid rgba(255, 255, 255, 0.15);
          cursor: pointer;
          transition: background-color 0.15s ease, box-shadow 0.15s ease;
        }

        .tile::after {
          content: attr(data-id);
          font-size: 10px;
          color: rgba(255, 255, 255, 0.4);
          padding: 4px;
        }

        .tile:hover {
          box-shadow: inset 0 0 0 2px rgba(255, 255, 255, 0.4);
        }

        @media (max-width: 768px) {
          #imageWrapper {
            max-width: 100%;
          }
        }
      </style>
    </div>
    <h2>Gestion Mots Crois√©s</h2>
    <div class="mot-croise-admin">
      <div class="form-container">
        <input type="text" id="wordInput" placeholder="Mot">
        <input type="text" id="clueInput" placeholder="Indice">
        <select id="directionInput">
          <option value="h">Horizontal</option>
          <option value="v">Vertical</option>
        </select>
        <button id="addWordBtn">Ajouter Mot</button>
      </div>

      <div class="controls">
        <button id="revealWordBtn">R√©v√©ler Mot S√©lectionn√©</button>
        <button id="revealAllBtn">R√©v√©ler Tous les Mots</button>
      </div>

      <div class="grid-wrapper">
        <div class="grid" id="grid"></div>
      </div>

      <div class="clues" id="clues">
        <h2>Indices</h2>
        <div class="clues-panel">
          <style>
            .clues-panel {
              display: flex;
              justify-content: space-around;
              gap: 20px;
            }

            .clues-section {
              margin-bottom: 20px;
            }

            .clues-section h3 {
              margin-bottom: 10px;
              font-size: 1.2rem;
            }
          </style>
          <div class="clues-section">
            <h3>Horizontales</h3>
            <div id="clues-h"></div>
          </div>

          <div class="clues-section">
            <h3>Verticales</h3>
            <div id="clues-v"></div>
          </div>
        </div>
      </div>


      <style>
        .form-container,
        .grid-wrapper,
        .controls {
          margin-top: 20px;
          width: 100%;
          max-width: 1100px;
        }

        input,
        select,
        button {
          padding: 8px 12px;
          margin: 4px;
          border-radius: 8px;
          border: none;
          font-size: 1rem;
        }

        button {
          cursor: pointer;
          background: var(--primary);
          color: white;
        }

        .grid-wrapper {
          display: flex;
          justify-content: center;
          margin-top: 20px;
        }

        .grid {
          display: grid;
          grid-template-columns: repeat(15, 30px);
          grid-template-rows: repeat(15, 30px);
          gap: 10px;
        }


        .cell {
          background: rgba(255, 255, 255, 0.18);
          border-radius: 10px;
          border: 1px solid rgba(255, 255, 255, 0.3);
          display: flex;
          align-items: center;
          justify-content: center;
          font-weight: bold;
          color: white;
          position: relative;
          font-size: 1rem;
        }

        .cell span {
          position: absolute;
          top: 2px;
          left: 2px;
          font-size: 0.6rem;
          opacity: 0.7;
        }

        .controls button {
          margin-right: 10px;
          margin-top: 10px;
        }
      </style>
      </style>
      <script>
        // ================= CONFIG =================
        const GRID_SIZE = 15;
        const grid = document.getElementById("grid");
        const cluesH = document.getElementById("clues-h");
        const cluesV = document.getElementById("clues-v");

        // ================= STATE =================
        let words = [];
        let selectedWordIndex = null;
        let wordCounter = 1;

        // ================= GRID INIT =================
        let gridCells = Array.from({ length: GRID_SIZE }, (_, r) =>
          Array.from({ length: GRID_SIZE }, (_, c) => {
            const cell = document.createElement("div");
            cell.classList.add("cell");
            grid.appendChild(cell);
            return cell;
          })
        );

        // ================= UTILS =================
        function normalizeWord(word) {
          return word.toUpperCase();
        }

        // ================= RENDER CLUES =================
        function renderClues() {
          cluesH.innerHTML = "";
          cluesV.innerHTML = "";
          words
            .slice()
            .sort((a, b) => a.number - b.number)
            .forEach(w => {
              const p = document.createElement("p");
              p.innerHTML = `<strong>${w.number}.</strong> ${w.clue}`;
              (w.direction === "h" ? cluesH : cluesV).appendChild(p);
            });
        }

        // ================= CHECK PLACEMENT =================
        function canPlaceWord(wordObj, row, col) {
          let crosses = 0;
          for (let i = 0; i < wordObj.word.length; i++) {
            let r = row, c = col;
            if (wordObj.direction === "h") c += i; else r += i;
            if (r < 0 || c < 0 || r >= GRID_SIZE || c >= GRID_SIZE) return false;
            const char = wordObj.word[i];
            const existing = gridCells[r][c].textContent || "";
            if (char === " ") continue;
            if (existing !== "" && existing !== char) return false; // pas d'√©crasement
            if (existing === char) crosses++;
          }
          // √Ä partir du 2e mot, il doit y avoir au moins un croisement
          if (words.length > 0 && crosses === 0) return false;
          return true;
        }

        // ================= PLACE WORD =================
        function placeWord(wordObj) {
          if (words.length === 0) {
            wordObj.row = Math.floor(GRID_SIZE / 2);
            wordObj.col = Math.floor((GRID_SIZE - wordObj.word.length) / 2);
            return true;
          }

          for (let placed of words) {
            for (let i = 0; i < placed.word.length; i++) {
              for (let j = 0; j < wordObj.word.length; j++) {
                if (placed.word[i] !== wordObj.word[j]) continue;
                let row, col;
                if (placed.direction === "h" && wordObj.direction === "v") {
                  row = placed.row - j;
                  col = placed.col + i;
                } else if (placed.direction === "v" && wordObj.direction === "h") {
                  row = placed.row + i;
                  col = placed.col - j;
                } else continue;
                if (canPlaceWord(wordObj, row, col)) {
                  wordObj.row = row;
                  wordObj.col = col;
                  return true;
                }
              }
            }
          }
          return false;
        }

        // ================= ADD WORD =================
        document.getElementById("addWordBtn").addEventListener("click", () => {
          const rawWord = document.getElementById("wordInput").value.trim();
          const clue = document.getElementById("clueInput").value.trim();
          const direction = document.getElementById("directionInput").value;

          if (!rawWord || !clue) return alert("Mot et indice requis");

          const wordObj = {
            word: normalizeWord(rawWord),
            clue,
            direction,
            revealed: false,
            number: wordCounter++
          };

          if (placeWord(wordObj)) {
            words.push(wordObj);
            renderGrid(true);
            renderClues(); // üî• Mettre √† jour les indices imm√©diatement
            socket.emit("updateGrid", { words }); // üîó Envoi au public
            document.getElementById("wordInput").value = "";
            document.getElementById("clueInput").value = "";
          } else alert("Placement impossible : aucun croisement valide.");
        });

        // ================= RENDER GRID =================
        function renderGrid(isAdmin = true) {
          for (let r = 0; r < GRID_SIZE; r++) {
            for (let c = 0; c < GRID_SIZE; c++) {
              const cell = gridCells[r][c];
              cell.innerHTML = "";
              cell.textContent = "";
              cell.className = "cell";
              cell.dataset.wordIndex = "";
              cell.dataset.position = "";
              cell.classList.remove("black");
            }
          }

          words.forEach((w, index) => {
            for (let i = 0; i < w.word.length; i++) {
              let r = w.row, c = w.col;
              if (w.direction === "h") c += i; else r += i;
              const char = w.word[i];
              const cell = gridCells[r][c];
              if (char === " ") { cell.classList.add("black"); continue; }

              // ‚ö° si d√©j√† une lettre (croisement), on ne l‚Äô√©crase pas
              if (!cell.textContent.includes(char)) cell.textContent += char;

              cell.dataset.wordIndex = index;
              cell.dataset.position = i;

              // Num√©ro en exposant seulement sur premi√®re lettre
              if (i === 0) {
                const num = document.createElement("sup");
                num.className = "number";
                num.textContent = w.number;
                cell.appendChild(num);
              }
            }
          });
        }

        // ================= REVEAL WORD =================
        document.getElementById("revealWordBtn").addEventListener("click", () => {
          if (selectedWordIndex === null) return alert("S√©lectionnez un mot");
          words[selectedWordIndex].revealed = true;
          socket.emit("revealWord", selectedWordIndex); // üîó Public
        });

        // ================= REVEAL ALL =================
        document.getElementById("revealAllBtn").addEventListener("click", () => {
          words.forEach(w => w.revealed = true);
          socket.emit("revealAll"); // üîó Public
        });

        // ================= SELECT WORD =================
        gridCells.flat().forEach(cell => {
          cell.addEventListener("click", () => {
            if (cell.dataset.wordIndex !== "") {
              selectedWordIndex = parseInt(cell.dataset.wordIndex);
              alert(`Mot s√©lectionn√© : ${words[selectedWordIndex].word}\nIndice : ${words[selectedWordIndex].clue}`);
            }
          });
        });
      </script>
    </div>

  </div>

  <footer>
    GSDDM LiveScore | D√©fi du G√©nie en Herbe (11·µâ √âdition) | 2025 - 2026 | V 2024.1.7 <br>
    <div class="documents d-flex space-between"><a href="documents/GSDDM-LiveScore-Documentation.pdf" target="_blank"
        style="color: #8a9bb8;">Documentation</a> | <a href="documents/Licence MIT.pdf" target="_blank"
        style="color: #8a9bb8;">Licence</a></div>
  </footer>

  <script>
    function updateScore(team, value) {
      console.log(`Envoyer score ${team} += ${value}`);
      socket.emit('updateScore', { team, value });
    }
  </script>
  <script>
    const socket = io();

    function nextLevel() {
      socket.emit("next-level");
    }

    function resetGame() {
      socket.emit("reset-image");
    }

    document.getElementById("imageInput").addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = () => {
        socket.emit("change-image", reader.result);
      };
      reader.readAsDataURL(file);
    });
  </script>
  <script>
    // √âquipe A
    document.getElementById('selectA').addEventListener('change', (e) => {
      const name = e.target.value;
      socket.emit('updateTeamName', { team: 'A', name });
    });

    // √âquipe B
    document.getElementById('selectB').addEventListener('change', (e) => {
      const name = e.target.value;
      socket.emit('updateTeamName', { team: 'B', name });
    });
  </script>
  <script>
    // Informations / Message
    document.getElementById("info-submit").addEventListener("click", () => {
      const msg = document.getElementById("info").value;
      console.log("Envoi du message:", msg);
      socket.emit("adminMessage", msg);
    });
  </script>
  <script>
    function elireHomme() {
      const nom = document.getElementById("hommeNom").value.trim();
      const equipe = document.getElementById("hommeEquipe").value;

      if (!nom) {
        alert("Veuillez saisir le nom du joueur.");
        return;
      }

      if (!equipe) {
        alert("Veuillez s√©lectionner la classe du joueur.");
        return;
      }

      // Envoyer via socket.io
      socket.emit("manOfMatch", { nom, equipe });

      // Actions facultatives: vider le champ ou afficher un message
      document.getElementById("hommeNom").value = "";
      document.getElementById("hommeEquipe").value = "";
    }

  </script>
  <script>
    let scheduledMatches = []; // tableau pour suivre les matchs programm√©s c√¥t√© admin

    function programmerMatch() {
      const teamA = document.getElementById("nextTeamA").value;
      const teamB = document.getElementById("nextTeamB").value;

      if (!teamA || !teamB) {
        alert("Veuillez s√©lectionner les deux √©quipes !");
        return;
      }

      // V√©rifier que l'une des √©quipes n'est pas d√©j√† programm√©e
      const duplicate = scheduledMatches.some(
        (match) => match.teamA === teamA || match.teamB === teamB
      );

      if (duplicate) {
        alert("Une de ces √©quipes est d√©j√† programm√©e !");
        return;
      }

      const newMatch = { teamA, teamB };
      scheduledMatches.push(newMatch);

      // Envoyer au serveur pour mise √† jour globale
      socket.emit("scheduleMatch", newMatch);

      // R√©initialiser les s√©lections
      document.getElementById("nextTeamA").value = "";
      document.getElementById("nextTeamB").value = "";
    }

    // Supprimer un match c√¥t√© admin
    function supprimerMatch(index) {
      scheduledMatches.splice(index, 1);
      socket.emit("deleteMatch", index);
    }
  </script>
  <script>
    document.getElementById('save-score').addEventListener('click', () => {
      const teamA = document.getElementById('selectA').value;
      const teamB = document.getElementById('selectB').value;
      const aScore = parseInt(document.getElementById('scoreA').textContent) || 0;
      const bScore = parseInt(document.getElementById('scoreB').textContent) || 0;

      if (!teamA || !teamB) {
        alert("S√©lectionnez les deux √©quipes !");
        return;
      }

      console.log("Admin envoie score :", { teamA, teamB, aScore, bScore });
      socket.emit('saveScore', { teamA, teamB, aScore, bScore });
    });
  </script>
</body>

</html>